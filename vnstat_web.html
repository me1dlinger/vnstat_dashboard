<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>ÁΩëÁªúÊµÅÈáèÁªüËÆ°</title>
    <link
      href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD//////////////////////////3I2JLdyNyTnczYjUAAAAAD///////////////////////////////////////////////////////////////9yNiPJdTgl/3g6Jv9yNyTKbzcnIAAAAACcpgBQnKYAiZ2lAJmepQBm////////////////AAAAAAAAAAAAAAAAcjcjdHY5Jf9yNiT/ci4m/3I1JPAAAAAAnqUARAAAAAAAAAAAnqcArZmqAA///////////wAAAAAAAAAAAAAAAHI3Ikp2NyX/dDwj/56nAP93RiH2AAAAAAAAAAAAAAAAAAAAAJ2mAG2dpgBT//////////8AAAAAAAAAAIFAKkNyNiP/bykm/5iaCf98VR//cDIk/gAAAAAAAAAAAAAAAAAAAACcpgCGoKYAK6BSO7agVDrMnlI5eZ5SOFGmVz3/hzwx/4uCEP97UR//cDEl/3Y5Jf8AAAAAAAAAAAAAAAAAAAAAnaYAnv////+hUzvppVY9/6ZXPf+nVz3/olE8/6J3Lf+PdB7/bS0k/3I3JP9zNyT/cjck72YzGQoAAAAAAAAAAJ6mAKD/////n1Q7UqlYPv+hVDv/oVM7/6FYOf+ekhj/pE4//4dELv9vNSL/cjck/3Q4Jf9yNiT3AAAAAJ6nAJ2bogAh/////wAAAACgVDrMpVY8/6JOPf+fjxv/oVI7/6FUO/+kVj3/h0Qu/281Iv9yNyT/dDgl/3I4JOmktgCVAAAAAP//////////nlI0IqFSPPOhaDL4oX8o/6dUP/+iVTv/oVQ7/6RWPf+GRC7/bzUi/3I3JP91OCX/bislpP////////////////////8AAAAAnK0ArQAAAAAAAAAAoVM78aNVPP+hVDv/pFY9/4ZDLv9zNiT/dTgl/3Y5Jf//////////////////////AAAAAJ2mAK4AAAAAAAAAAJZLLRGhVDr4o1U8/6FUO/+oWj3/pM4AYmwqIoR4Oib/cTYkh////////////////56oAGmepwBxAAAAAAAAAAAAAAAAmUwzFKFRO+ylVT3/pVY9/6RPPoeHQy7Fczck/3E2I7v///////////////+cpQCQnKgAQwAAAAAAAAAAAAAAAAAAAACdrQCPn2oxzahWPv+qWD7/qVg+/4lFL/9vNSHU////////////////nKYAap2lAIAAAAAAAAAAAKGoACacpgC/nqgAZgAAAACUUjEfoVQ6laFUO8OhVDv/oVQ7//////////////////////+dpgCvnqYApZ2nAKSdpgCa////////////////////////////////////////////////AYAAAAByAAA8PQAAPD8AADg9AAAwPAAAABwAAIAKAACAAgAAQAAAACwAAAAuEAAAPwAAAB8AAAAu4AAAAAAAAA=="
      rel="icon"
      type="image/x-icon"
    />
    <link
      rel="shortcut icon"
      href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD//////////////////////////3I2JLdyNyTnczYjUAAAAAD///////////////////////////////////////////////////////////////9yNiPJdTgl/3g6Jv9yNyTKbzcnIAAAAACcpgBQnKYAiZ2lAJmepQBm////////////////AAAAAAAAAAAAAAAAcjcjdHY5Jf9yNiT/ci4m/3I1JPAAAAAAnqUARAAAAAAAAAAAnqcArZmqAA///////////wAAAAAAAAAAAAAAAHI3Ikp2NyX/dDwj/56nAP93RiH2AAAAAAAAAAAAAAAAAAAAAJ2mAG2dpgBT//////////8AAAAAAAAAAIFAKkNyNiP/bykm/5iaCf98VR//cDIk/gAAAAAAAAAAAAAAAAAAAACcpgCGoKYAK6BSO7agVDrMnlI5eZ5SOFGmVz3/hzwx/4uCEP97UR//cDEl/3Y5Jf8AAAAAAAAAAAAAAAAAAAAAnaYAnv////+hUzvppVY9/6ZXPf+nVz3/olE8/6J3Lf+PdB7/bS0k/3I3JP9zNyT/cjck72YzGQoAAAAAAAAAAJ6mAKD/////n1Q7UqlYPv+hVDv/oVM7/6FYOf+ekhj/pE4//4dELv9vNSL/cjck/3Q4Jf9yNiT3AAAAAJ6nAJ2bogAh/////wAAAACgVDrMpVY8/6JOPf+fjxv/oVI7/6FUO/+kVj3/h0Qu/281Iv9yNyT/dDgl/3I4JOmktgCVAAAAAP//////////nlI0IqFSPPOhaDL4oX8o/6dUP/+iVTv/oVQ7/6RWPf+GRC7/bzUi/3I3JP91OCX/bislpP////////////////////8AAAAAnK0ArQAAAAAAAAAAoVM78aNVPP+hVDv/pFY9/4ZDLv9zNiT/dTgl/3Y5Jf//////////////////////AAAAAJ2mAK4AAAAAAAAAAJZLLRGhVDr4o1U8/6FUO/+oWj3/pM4AYmwqIoR4Oib/cTYkh////////////////56oAGmepwBxAAAAAAAAAAAAAAAAmUwzFKFRO+ylVT3/pVY9/6RPPoeHQy7Fczck/3E2I7v///////////////+cpQCQnKgAQwAAAAAAAAAAAAAAAAAAAACdrQCPn2oxzahWPv+qWD7/qVg+/4lFL/9vNSHU////////////////nKYAap2lAIAAAAAAAAAAAKGoACacpgC/nqgAZgAAAACUUjEfoVQ6laFUO8OhVDv/oVQ7//////////////////////+dpgCvnqYApZ2nAKSdpgCa////////////////////////////////////////////////AYAAAAByAAA8PQAAPD8AADg9AAAwPAAAABwAAIAKAACAAgAAQAAAACwAAAAuEAAAPwAAAB8AAAAu4AAAAAAAAA=="
      type="image/x-icon"
    />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        padding: 20px;
        color: black;
      }
      /* Ê∑ªÂä†ÁôªÂΩïÁïåÈù¢Ê†∑Âºè */
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f0f2f5;
      }

      .login-box {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        width: 400px;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #666;
      }

      .form-group input {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .error-message {
        color: #ff4444;
        margin-top: 1rem;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(250px, 1fr));
        gap: var(--gap-size);
        padding: 0 var(--gap-size);
        width: calc(100% - 2 * var(--gap-size));
        margin: 0 auto;
      }

      /* Ê∑ªÂä†ÂÆπÂô®Ê†∑Âºè */
      .stat-container {
        display: flex;
        justify-content: space-between;
        padding: 0 10%;
        /* ‰∏§‰æßÈó¥Ë∑ù */
        margin: 20px 0;
      }

      .stat-card {
        background: #000000;
        border: 5px solid #cd6d27;
        border-radius: 30px;
        padding: 25px;
        color: white;
        position: relative;
        min-height: 150px;
        box-shadow: 0 4px 8px rgba(205, 109, 39, 0.2);
        box-sizing: border-box;
        width: 18%;
        min-width: 220px;
        margin: 0 1%;
        flex-shrink: 0;
      }

      /* ÂìçÂ∫îÂºèÂ§ÑÁêÜ */
      @media (max-width: 1200px) {
        .stat-container {
          flex-wrap: wrap;
          justify-content: flex-start;
        }

        .stat-card {
          width: 48%;
          margin: 1%;
        }
      }

      .stat-label {
        position: absolute;
        bottom: -35px;
        left: 50%;
        transform: translateX(-50%);
        background: #cd6d27;
        color: white;
        padding: 6px 25px;
        border-radius: 0 0 4px 4px;
        font-size: 0.9em;
        text-align: center;
        white-space: nowrap;
        z-index: 1;
      }

      .stat-row {
        display: flex;
        align-items: center;
        /* margin: 15px 0; */
        padding: 8px;
        border-bottom: 1px solid #333;
      }

      .stat-icon {
        font-size: 1.4em;
        margin-right: 15px;
        width: 30px;
        text-align: center;
      }

      .stat-value {
        font-size: 1.8em;
        font-weight: 500;
        position: relative;
      }

      .stat-unit {
        font-size: 0.6em;
        vertical-align: super;
        margin-left: 3px;
        color: #cd6d27;
      }

      .control-bar {
        display: flex;
        gap: 15px;
        background: #000;
        border-radius: 8px;
        margin: 44px 0;
        align-items: center;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        padding: 13px 30px;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 1;
      }

      .left {
        justify-content: flex-start;
      }

      .center {
        justify-content: center;
      }

      .right {
        justify-content: flex-end;
      }

      .date-range {
        margin: 0 20px;

        color: white;
      }

      /* ÂìçÂ∫îÂºèÂ§ÑÁêÜ */
      @media (max-width: 768px) {
        .control-bar {
          flex-wrap: wrap;
          gap: 15px;
        }

        .control-group {
          flex: 0 0 100%;
          justify-content: center !important;
        }
      }
      select {
        background: #cd6d27;
        color: white;
        border: 1px solid #cd6d27;
        padding: 8px 15px;
        border-radius: 4px;
      }

      button {
        background: #000;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: opacity 0.3s;
      }

      .time-display {
        font-size: 0.9em;
        line-height: 1.4;
      }

      .time-row {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .time-label {
        color: white;
        white-space: nowrap;
      }

      .time-value {
        color: white;
        font-weight: 500;
      }

      .traffic-summary {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin: -1rem 0;
        font-size: 1.1rem;
      }

      .summary-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
      }

      .summary-item i {
        font-size: 1.2rem;
      }

      button:hover {
        opacity: 0.9;
      }

      .view-switcher {
        position: relative;
        margin-bottom: 1rem;
        margin-top: -40px;
      }

      .switch-container {
        display: flex;
        /* position: absolute; */
        top: 10px;
        right: 10px;
        z-index: 10;
        display: flex;
        gap: 8px;
      }

      .switch-container button {
        background: none;
        border: 1px solid #e4e4e7;
        border-radius: 6px;
        padding: 8px;
        cursor: pointer;
        opacity: 0.6;
        transition: all 0.2s;
      }

      .switch-container button.active {
        opacity: 1;
        border-color: #3b82f6;
        color: #3b82f6;
      }

      /* ÁßªÈô§ÂÖ®Â±ÄbuttonÊ†∑ÂºèÔºåÊîπ‰∏∫ÊåáÂÆöÁ±ªÂêç */
      .view-switch {
        background: white !important;
        /* Âº∫Âà∂ÁôΩËâ≤ËÉåÊôØ */
        color: #333 !important;
        /* Ê∑±Ëâ≤ÊñáÂ≠ó */
        border: 1px solid #e4e4e7 !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
      }

      .view-switch.active {
        border-color: #3b82f6 !important;
        color: #3b82f6 !important;
        box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
      }

      .data-table {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9em;
      }

      th {
        background: #f8fafc;
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #e5e7eb;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
      }
      th:hover {
        background: #f1f5f9;
      }
      th i {
        margin-left: 8px;
        font-size: 0.8em;
        color: #64748b;
      }
      td {
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
      }

      tr:nth-child(even) {
        background: #f8fafc;
      }
      /* API ËÆæÁΩÆÊåâÈíÆÂíåÂºπÁ™óÊ†∑Âºè */
      .api-settings-button {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #fff;
        color: #000;
        border: none;
        border-radius: 4px;
        padding: 8px 15px;
        cursor: pointer;
        z-index: 1000;
      }

      .api-settings-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
      }

      .api-settings-content {
        background: white;
        border-radius: 8px;
        padding: 20px;
        width: 400px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .api-settings-content h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: #333;
      }

      .api-input {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .api-settings-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .api-settings-buttons button {
        padding: 8px 15px;
        cursor: pointer;
      }

      .save-button {
        background: #cd6d27;
        color: white;
      }

      .cancel-button {
        background: #f0f0f0;
        color: #333;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <!-- ÁôªÂΩïÁïåÈù¢ -->
      <div v-if="!isAuthenticated" class="login-container">
        <div class="login-box">
          <h2>ÁΩëÁªúÊµÅÈáèÁªüËÆ°Á≥ªÁªü</h2>
          <form @submit.prevent="handleLogin">
            <div class="form-group">
              <label><i class="fas fa-user"></i> Áî®Êà∑Âêç</label>
              <input type="text" v-model="loginForm.username" required>
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> ÂØÜÁ†Å</label>
              <input type="password" v-model="loginForm.password" required>
            </div>
            <button type="submit" :disabled="loggingIn">
              {{ loggingIn ? 'ÁôªÂΩï‰∏≠...' : 'ÁôªÂΩï' }}
            </button>
            <div v-if="loginError" class="error-message">{{ loginError }}</div>
          </form>
        </div>
      </div>
      <div v-else>
        <!-- APIËÆæÁΩÆÊåâÈíÆ -->
        <button class="api-settings-button" @click="showApiSettings">
          <i class="fas fa-cog"></i>
        </button>
        <!-- APIËÆæÁΩÆÂºπÁ™ó -->
        <div class="api-settings-modal" v-if="apiSettingsVisible">
          <div class="api-settings-content">
            <h3>API Êé•Âè£ËÆæÁΩÆ</h3>
            <input type="text" class="api-input" v-model="assistApi" placeholder="ËØ∑ËæìÂÖ•APIÂú∞ÂùÄ">
            <div class="api-settings-buttons">
                <button class="cancel-button" @click="cancelApiSettings">ÂèñÊ∂à</button>
              <button class="save-button" @click="saveApiSettings">‰øùÂ≠ò</button>
            </div>
          </div>
        </div>
        <!-- ÁªüËÆ°Âç°Áâá -->
        <div class="stat-container" v-if="currentInterface">
          <!-- ÊÄªÁªüËÆ° -->
          <div class="stat-card">
            <div class="stat-row">
              <i class="fas fa-tachometer-alt stat-icon"></i>
              <div class="stat-value">
                {{ formatSum(currentInterface.traffic.total).value }}
                <span class="stat-unit"
                  >{{ formatSum(currentInterface.traffic.total).unit }}</span
                >
              </div>
            </div>
            <div class="stat-row">
              <i class="fas fa-arrow-down stat-icon"></i>
              <div class="stat-value">
                {{ formatBytes(currentInterface.traffic.total.rx).value }}
                <span class="stat-unit"
                  >{{ formatBytes(currentInterface.traffic.total.rx).unit }}</span
                >
              </div>
            </div>
            <div class="stat-row">
              <i class="fas fa-arrow-up stat-icon"></i>
              <div class="stat-value">
                {{ formatBytes(currentInterface.traffic.total.tx).value }}
                <span class="stat-unit"
                  >{{ formatBytes(currentInterface.traffic.total.tx).unit }}</span
                >
              </div>
            </div>
            <div class="stat-label">ÊÄªËÆ°</div>
          </div>
          <div
            class="stat-card"
            v-for="(data, title) in summaryData"
            :key="title"
          >
            <div class="stat-row">
              <i class="fas fa-chart-bar stat-icon"></i>
              <div class="stat-value">
                {{ formatSum(data).value }}
                <span class="stat-unit">{{ formatSum(data).unit }}</span>
              </div>
            </div>
            <div class="stat-row">
              <i class="fas fa-arrow-down stat-icon"></i>
              <div class="stat-value">
                {{ formatBytes(data.rx).value }}
                <span class="stat-unit">{{ formatBytes(data.rx).unit }}</span>
              </div>
            </div>
            <div class="stat-row">
              <i class="fas fa-arrow-up stat-icon"></i>
              <div class="stat-value">
                {{ formatBytes(data.tx).value }}
                <span class="stat-unit">{{ formatBytes(data.tx).unit }}</span>
              </div>
            </div>
            <div class="stat-label">{{ title.toUpperCase() }}</div>
          </div>
        </div>

        <!-- ‰øÆÊîπÂêéÁöÑÊéßÂà∂Êù°ÁªìÊûÑ -->
        <div class="control-bar">
          <!-- Â∑¶‰æßÊéß‰ª∂ -->
          <div class="control-group left" v-show="!interfacesDataMode">
            <select v-model="timeRangeType">
              <option value="hour">ÊåâÊó∂</option>
              <option value="day">ÊåâÊó•</option>
              <option value="month">ÊåâÊúà</option>
              <option value="year">ÊåâÂπ¥</option>
            </select>
          </div>
          <div class="control-group center" v-show="!interfacesDataMode">
            <button @click="adjustTime(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="date-range">{{ dateRange }}</span>
            <button
              :style="{ visibility: showNextButton ? 'visible' : 'hidden' }"
              @click="adjustTime(1)"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <!-- Âè≥‰æßÁΩëÂç°ÈÄâÊã© -->
          <div class="control-group right">
            <div class="time-display" v-if="selectedInterface">
              <div class="time-row">
                <span class="time-label">ÁªüËÆ°ÂºÄÂßãÔºö</span>
                <span class="time-value"
                  >{{ formatTime(selectedInterface.created) }}</span
                >
              </div>
              <div class="time-row">
                <span class="time-label">ÊúÄÂêéÊõ¥Êñ∞Ôºö</span>
                <span class="time-value"
                  >{{ formatTime(selectedInterface.updated) }}</span
                >
              </div>
            </div>
            <select v-model="selectedInterface" v-show="!interfacesDataMode">
              <option v-for="iface in interfaces" :value="iface">
                {{ iface.name }}
              </option>
            </select>
            <button title="ÊåâÁΩëÂç°ÁªüËÆ°" @click="handleShowInterfaceData()">
              <i class="fas fa-network-wired"></i>
            </button>
          </div>
        </div>
        <div v-show="!interfacesDataMode">
          <div class="traffic-summary">
            <div class="summary-item" title="‰∏äË°åÊµÅÈáè">
              <i class="fas fa-upload text-blue-500"></i>
              <span>{{ uploadGB }}</span>
            </div>
            <div class="summary-item" title="ÊÄªÊµÅÈáè">
              <i class="fas fa-exchange-alt text-purple-500"></i>
              <span>{{ totalGB }}</span>
            </div>
            <div class="summary-item" title="‰∏ãË°åÊµÅÈáè">
              <i class="fas fa-download text-green-500"></i>
              <span>{{ downloadGB }}</span>
            </div>
          </div>
          <!-- Âú®ÂõæË°®ÂÆπÂô®‰∏äÊñπÊ∑ªÂä† -->
          <div class="view-switcher right">
            <div class="switch-container">
              <button
                @click="currentView = 'chart'"
                class="view-switch"
                :class="{active: currentView === 'chart'} "
                title="ÂõæË°®ËßÜÂõæ"
              >
                <i class="fas fa-chart-line"></i>
              </button>
              <button
                @click="currentView = 'table'"
                class="view-switch"
                :class="{active: currentView === 'table'}"
                title="Ë°®Ê†ºËßÜÂõæ"
              >
                <i class="fas fa-table"></i>
              </button>
            </div>
          </div>
          <!-- ÂõæË°®ÂÆπÂô® -->
          <div class="chart-container">
            <div v-show="currentView === 'chart'" id="trafficChart"></div>
            <div v-show="currentView === 'table'" class="data-table">
              <table>
                <thead>
                  <tr>
                    <th @click="sortTable('timestamp')">
                      Êó•Êúü/Êó∂Èó¥
                      <i class="fas" :class="sortIcon('timestamp')"></i>
                    </th>
                    <th @click="sortTable('tx')">
                      ‰∏äË°å
                      <i class="fas" :class="sortIcon('tx')"></i>
                    </th>
                    <th @click="sortTable('rx')">
                      ‰∏ãË°å
                      <i class="fas" :class="sortIcon('rx')"></i>
                    </th>
                    <th>ÊÄªËÆ°</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="item in sortedTableData" :key="item.timestamp">
                    <td>{{ getformatTableTime(item.date,item.time) }}</td>
                    <td>
                      {{ formatBytes(item.tx).value+formatBytes(item.tx).unit }}
                    </td>
                    <td>
                      {{ formatBytes(item.rx).value +formatBytes(item.rx).unit}}
                    </td>
                    <td>
                      {{ formatBytes(item.tx + item.rx).value+formatBytes(item.tx
                      + item.rx).unit }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- ÁΩëÂç°ÁªüËÆ°Ë°®Ê†º -->
        <div v-show="interfacesDataMode" class="data-table">
          <table>
            <thead>
              <tr>
                <th @click="sortTable('name')">
                  ÁΩëÂç°ÂêçÁß∞
                  <i class="fas" :class="sortIcon('name')"></i>
                </th>
                <th @click="sortTable('todayRx')">
                  ‰ªäÊó•‰∏ãË°å
                  <i class="fas" :class="sortIcon('todayRx')"></i>
                </th>
                <th @click="sortTable('todayTx')">
                  ‰ªäÊó•‰∏äË°å
                  <i class="fas" :class="sortIcon('todayTx')"></i>
                </th>
                <th @click="sortTable('todayTotal')">
                  ‰ªäÊó•ÊÄªËÆ°
                  <i class="fas" :class="sortIcon('todayTotal')"></i>
                </th>
                <th @click="sortTable('totalRx')">
                  ÂÖ®ÈÉ®‰∏ãË°å
                  <i class="fas" :class="sortIcon('totalRx')"></i>
                </th>
                <th @click="sortTable('totalTx')">
                  ÂÖ®ÈÉ®‰∏äË°å
                  <i class="fas" :class="sortIcon('totalTx')"></i>
                </th>
                <th @click="sortTable('totalTotal')">
                  ÂÖ®ÈÉ®ÊÄªËÆ°
                  <i class="fas" :class="sortIcon('totalTotal')"></i>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in sortedInterfaces" :key="item.name">
                <td>{{ item.name }}</td>
                <td>
                  {{ formatBytes(item.todayRx).value }}{{
                  formatBytes(item.todayRx).unit }}
                </td>
                <td>
                  {{ formatBytes(item.todayTx).value }}{{
                  formatBytes(item.todayTx).unit }}
                </td>
                <td>
                  {{ formatBytes(item.todayTotal).value }}{{
                  formatBytes(item.todayTotal).unit }}
                </td>
                <td>
                  {{ formatBytes(item.totalRx).value }}{{
                  formatBytes(item.totalRx).unit }}
                </td>
                <td>
                  {{ formatBytes(item.totalTx).value }}{{
                  formatBytes(item.totalTx).unit }}
                </td>
                <td>
                  {{ formatBytes(item.totalTotal).value }}{{
                  formatBytes(item.totalTotal).unit }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
    <script>
      new Vue({
        el: "#app",
        data: {
          // ËÆ§ËØÅÁõ∏ÂÖ≥Êï∞ÊçÆ
          isAuthenticated: true,
          loginForm: { username: '', password: '' },
          loggingIn: false,
          loginError: '',
          authToken: null,
          tokenRefreshTimer: null,

          rawData: {},
          interfaces: [],
          selectedInterface: null,
          chart: null,
          timeRangeType: "day",
          currentRange: new Date(),
          currentStats: {},
          currentView: "chart",
          filteredData: [],
          interfacesDataMode: false,
          showNextButton: false,
          sortKey: "name",
          sortOrder: "asc",
          interfacesTableData: [],
          tableData: [],
          assistApi: `${window.location.protocol}//${window.location.host}/assist-vnstat`,
          defaultInterface: "enp3s0",
          apiSettingsVisible:false,
        },
        computed: {
          uploadGB() {
            return (
              this.formatBytes(this.currentStats.tx).value +
              this.formatBytes(this.currentStats.tx).unit
            );
          },
          downloadGB() {
            return (
              this.formatBytes(this.currentStats.rx).value +
              this.formatBytes(this.currentStats.rx).unit
            );
          },
          totalGB() {
            return (
              this.formatBytes(this.currentStats.total).value +
              this.formatBytes(this.currentStats.total).unit
            );
          },
          currentInterface() {
            return this.selectedInterface || this.interfaces[0];
          },
          summaryData() {
            return {
              Êú¨Êúà: this.getMonthData(
                this.selectedInterface || this.interfaces[0]
              ),
              ‰ªäÊó•: this.getDayData(
                this.selectedInterface || this.interfaces[0]
              ),
              Êò®Êó•: this.getYesterdayData(
                this.selectedInterface || this.interfaces[0]
              ),
            };
          },
          sortedInterfaces() {
            return [...this.interfacesTableData].sort((a, b) => {
              let modifier = -1;
              if (this.sortOrder === "asc") modifier = 1;
              if (a[this.sortKey] < b[this.sortKey]) return -1 * modifier;
              if (a[this.sortKey] > b[this.sortKey]) return 1 * modifier;
              return 0;
            });
          },
          sortedTableData() {
            return [...this.tableData].sort((a, b) => {
              let modifier = -1;
              if (this.sortOrder === "asc") modifier = 1;
              if (a[this.sortKey] < b[this.sortKey]) return -1 * modifier;
              if (a[this.sortKey] > b[this.sortKey]) return 1 * modifier;
              return 0;
            });
          },
          dateRange() {
            const d = new Date(this.currentRange);
            const format = (date, withDay = true, withTime = false) => {
              let result = `${date.getFullYear()}-${String(
                date.getMonth() + 1
              ).padStart(2, "0")}${
                withDay ? `-${String(date.getDate()).padStart(2, "0")}` : ""
              }`;
              if (withTime) {
                result += ` ${String(date.getHours()).padStart(2, "0")}:00`;
              }
              return result;
            };
            switch (this.timeRangeType) {
              case "hour":
                const hourStart = new Date(d);
                hourStart.setMinutes(0, 0, 0);
                const hourEnd = new Date(hourStart);
                hourEnd.setHours(hourStart.getHours() + 1);
                return `${format(hourStart, true, true)} - ${format(
                  hourEnd,
                  true,
                  true
                )}`;
              case "day":
                const day = new Date(d);
                return `${format(day)}`;
              case "month":
                const start = new Date(d.getFullYear(), d.getMonth(), 1);
                const end = new Date(d.getFullYear(), d.getMonth() + 1, 0);
                return `${format(start)} - ${format(end)}`;
              case "year":
                return `${d.getFullYear()}Âπ¥`;
            }
          },
        },
        watch: {
          timeRangeType() {
            this.showNextButton = false;
            (this.currentRange = new Date()), this.updateChart();
          },
          currentDate() {
            this.updateChart();
          },
          selectedInterface() {
            this.updateChart();
          },
        },
        methods: {
          // ÁôªÂΩïÈÄªËæë
          async handleLogin() {
            this.loggingIn = true;
            this.loginError = '';
            try {
              const response = await fetch(`${this.assistApi}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(this.loginForm)
              });
              if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'ÁôªÂΩïÂ§±Ë¥•');
              }

              const { token } = await response.json();
              this.handleAuthSuccess(token);
            } catch (err) {
              this.loginError = err.message || 'ÁôªÂΩïËØ∑Ê±ÇÂ§±Ë¥•';
            } finally {
              this.loggingIn = false;
            }
          },
          // ËÆ§ËØÅÊàêÂäüÂ§ÑÁêÜ
          handleAuthSuccess(token) {
            // Â≠òÂÇ®Token
            localStorage.setItem('jwt_token', token);
            this.authToken = token;
            this.isAuthenticated = true;
            // Âä†ËΩΩÊï∞ÊçÆ
            this.loadData();
          },
          // Ê≥®ÈîÄÂ§ÑÁêÜ
          handleLogout() {
            localStorage.removeItem('jwt_token');
            this.isAuthenticated = false;
            this.authToken = null;
          },
          async loadData(){
            const response = await this.fetchWithAuth(this.assistApi+'/json.cgi');
            console.log("üöÄ ~ loadData ~ response:", response)
            this.rawData = await response.json();
            this.interfaces = this.rawData.interfaces;
            if (this.interfaces.length > 0) {
              const defaultInterface = this.interfaces.find(
                (intf) => intf.name === this.defaultInterface
              );
              this.selectedInterface = defaultInterface || this.interfaces[0];
            }
            await this.$nextTick();
          },
          async fetchWithAuth(url, options = {}) {
            const response = await fetch(url, {
              ...options,
              headers: {
                'Authorization': `Bearer ${this.authToken}`,
                ...options.headers
              }
            });
            if (response.status === 401) {
              this.handleLogout();
            }
            return response;
          },
          formatBytes(bytes) {
            const units = ["B", "KB", "MB", "GB", "TB"];
            let i = 0;
            bytes = Number(bytes);
            while (bytes >= 1024 && i < units.length - 1) {
              bytes /= 1024;
              i++;
            }
            return {
              value: bytes.toFixed(2),
              unit: units[i],
            };
          },
          formatSum(data) {
            const total = data.rx + data.tx;
            return this.formatBytes(total);
          },
          getMonthData(interface) {
            const year = new Date().getFullYear();
            const month = new Date().getMonth() + 1;
            return (
              interface.traffic.month.find(
                (d) => d.date.year === year && d.date.month === month
              ) || { rx: 0, tx: 0 }
            );
          },
          getDayData(interface) {
            const year = new Date().getFullYear();
            const month = new Date().getMonth() + 1;
            const day = new Date().getDate();
            return (
              interface.traffic.day.find(
                (d) =>
                  d.date.year === year &&
                  d.date.month === month &&
                  d.date.day === day
              ) || { rx: 0, tx: 0 }
            );
          },
          getYesterdayData(interface) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const year = yesterday.getFullYear();
            const month = yesterday.getMonth() + 1;
            const day = yesterday.getDate();
            return (
              interface.traffic.day.find(
                (d) =>
                  d.date.year === year &&
                  d.date.month === month &&
                  d.date.day === day
              ) || { rx: 0, tx: 0 }
            );
          },
          adjustTime(offset) {
            const d = new Date(this.currentRange);
            const now = new Date();
            let isLimitReached = false;
            // ‰øùÂ≠òÂéüÂßãÊó•ÊúüÔºàÁî®‰∫éÈó∞Âπ¥Â§ÑÁêÜÔºâ
            const originalDate = d.getDate();
            const originalMonth = d.getMonth();
            switch (this.timeRangeType) {
              case "hour":
                // Ëá™Âä®Â§ÑÁêÜË∑®Êó•/Êúà/Âπ¥
                d.setTime(d.getTime() + offset * 60 * 60 * 1000);
                // Á≤æÁ°ÆÊØîËæÉÂà∞Â∞èÊó∂Á∫ßÂà´
                isLimitReached =
                  d.getFullYear() === now.getFullYear() &&
                  d.getMonth() === now.getMonth() &&
                  d.getDate() === now.getDate() &&
                  d.getHours() === now.getHours();
                break;
              case "day":
                d.setDate(d.getDate() + offset);
                // ÊØîËæÉÊó•ÊúüÈÉ®ÂàÜ
                isLimitReached = this.isSameDay(d, now);
                break;
              case "month":
                // ÂÖàËÆæÁΩÆ‰∏∫ÂΩìÊúàÁ¨¨‰∏ÄÂ§©ÔºåÈÅøÂÖçË∑®ÊúàÊó∂ÁöÑÊó•ÊúüÊ∫¢Âá∫ÈóÆÈ¢ò
                d.setDate(1);
                d.setMonth(d.getMonth() + offset);
                // Â§ÑÁêÜË∑®ÊúàË∞ÉÊï¥ÂêéÁöÑÊó•ÊúüÊúâÊïàÊÄßÔºàÂ¶Ç1Êúà31Êó•‚Üí2Êúà28/29Êó•Ôºâ
                const maxDays = new Date(
                  d.getFullYear(),
                  d.getMonth() + 1,
                  0
                ).getDate();
                d.setDate(Math.min(originalDate, maxDays));
                isLimitReached =
                  d.getFullYear() === now.getFullYear() &&
                  d.getMonth() === now.getMonth();
                break;
              case "year":
                const targetYear = d.getFullYear() + offset;
                d.setFullYear(targetYear);
                // Â§ÑÁêÜÈó∞Âπ¥2Êúà29Êó•ÁöÑÊÉÖÂÜµ
                if (originalMonth === 1 && originalDate === 29) {
                  const isLeapYear = (year) =>
                    (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
                  if (!isLeapYear(targetYear)) {
                    d.setMonth(1); // February
                    d.setDate(28);
                  }
                }
                isLimitReached = d.getFullYear() === now.getFullYear();
                break;
            }
            this.showNextButton = !isLimitReached;
            this.currentRange = d;
            this.updateChart();
          },
          //ÊØîËæÉ‰∏§‰∏™Êó•ÊúüÊòØÂê¶ÊòØÂêå‰∏ÄÂ§©
          isSameDay(date1, date2) {
            return (
              date1.getFullYear() === date2.getFullYear() &&
              date1.getMonth() === date2.getMonth() &&
              date1.getDate() === date2.getDate()
            );
          },
          showApiSettings(){
            this.apiSettingsVisible = !this.apiSettingsVisible;
          },
          saveApiSettings(){
            localStorage.setItem('assist_api', this.assistApi);
            this.apiSettingsVisible = false;
            this.loadData()
          },
          cancelApiSettings(){
            this.apiSettingsVisible = false;
          },
          handleShowInterfaceData() {
            if (this.interfacesDataMode) {
              this.interfacesDataMode = false;
              this.updateChart();
            } else {
              this.interfacesDataMode = true;
              this.handleInterfacesData();
            }
          },
          sortTable(key) {
            if (this.sortKey === key) {
              this.sortOrder = this.sortOrder === "asc" ? "desc" : "asc";
            } else {
              this.sortKey = key;
              this.sortOrder = "desc";
            }
          },
          sortIcon(key) {
            if (this.sortKey !== key) return "fa-sort";
            return this.sortOrder === "asc" ? "fa-sort-up" : "fa-sort-down";
          },
          handleInterfacesData() {
            this.interfacesTableData = this.interfaces.map((item) => {
              const todayData = this.getDayData(item);
              return {
                name: item.name,
                todayRx: todayData.rx,
                todayTx: todayData.tx,
                todayTotal: todayData.rx + todayData.tx,
                totalRx: item.traffic.total.rx,
                totalTx: item.traffic.total.tx,
                totalTotal: item.traffic.total.rx + item.traffic.total.tx,
              };
            });
          },
          getMergedSeriesData() {
            const dataType = {
              hour: "fiveminute",
              day: "hour",
              month: "day",
              year: "month",
            }[this.timeRangeType];
            let totalRx = 0,
              totalTx = 0;
            const rawData = this.selectedInterface.traffic[dataType];
            const currentDate = new Date(this.currentRange);
            const rangeYear = currentDate.getFullYear();
            const rangeMonth = currentDate.getMonth() + 1;
            const rangeDay = currentDate.getDate();
            const rangeHour = currentDate.getHours();
            this.filteredData = rawData.filter((item) => {
              let match = false;
              switch (this.timeRangeType) {
                case "hour":
                  var itemYear = item.date.year;
                  var itemMonth = item.date.month;
                  var itemDay = item.date.day;
                  var itemHour = item.time ? item.time.hour : 0;
                  match =
                    itemYear === rangeYear &&
                    itemMonth === rangeMonth &&
                    itemDay === rangeDay &&
                    itemHour === rangeHour;
                  break;
                case "day":
                  var itemYear = item.date.year;
                  var itemMonth = item.date.month;
                  var itemDay = item.date.day;
                  match =
                    itemYear === rangeYear &&
                    itemMonth === rangeMonth &&
                    itemDay === rangeDay;
                  break;
                case "month":
                  var itemYear = item.date.year;
                  var itemMonth = item.date.month;
                  var itemDay = item.date.day;
                  match = itemYear === rangeYear && itemMonth === rangeMonth;
                  break;
                case "year":
                  var itemYear = item.date.year;
                  match = itemYear === rangeYear;
                  break;
              }
              if (match) {
                totalRx += item.rx || 0;
                totalTx += item.tx || 0;
              }
              return match;
            });
            this.currentStats = {
              rx: totalRx,
              tx: totalTx,
              total: totalRx + totalTx,
            };
            this.tableData = this.filteredData;
            const getXValue = (date, time) =>
              this.getXValue(date, time, dataType);
            return [
              this.generateSeries("‰∏äË°å", "tx", "#E0C3A1", getXValue),
              this.generateSeries("‰∏ãË°å", "rx", "#E37563", getXValue),
            ];
          },
          generateSeries(name, field, color, getX) {
            return {
              name,
              data: this.filteredData.map((d) => ({
                x: getX(d.date, d.time),
                y: d[field] / (1024 * 1024), // Áªü‰∏ÄÂçï‰ΩçËΩ¨Êç¢
              })),
              color,
            };
          },
          getXValue(date, time, dataKey) {
            const itemYear = date.year;
            const itemMonth = String(date.month).padStart(2, "0");
            const itemDay = String(date.day).padStart(2, "0");
            var itemHour = "";
            var itemMinute = "";
            if (time) {
              itemHour = String(time.hour).padStart(2, "0");
              itemMinute = String(time.minute).padStart(2, "0");
            }
            switch (dataKey) {
              case "fiveminute":
                return `${itemYear}-${itemMonth}-${itemDay} ${itemHour}:${itemMinute}`;
              case "hour":
                return `${itemYear}-${itemMonth}-${itemDay} ${itemHour}Êó∂`;
              case "day":
                return `${itemYear}-${itemMonth}-${itemDay}`;
              case "month":
                return `${itemYear}-${itemMonth}`;
            }
          },
          updateChart() {
            const options = {
              chart: { type: "area", height: 400 },
              series: this.getMergedSeriesData(),
              fill: {
                type: "solid",
              },
              dataLabels: {
                enabled: false,
              },
              stroke: {
                curve: "smooth",
                width: 2,
              },
              markers: {
                size: 3,
                hover: { size: 5 },
              },
              xaxis: {
                type: "category",
                title: { text: this.getXAxisTitle() },
              },
              yaxis: {
                title: { text: "ÊµÅÈáè (MB)" },
                labels: {
                  formatter: function (value) {
                    return value % 1 === 0
                      ? value.toFixed(0) // Êï¥Êï∞ÊòæÁ§∫
                      : value.toFixed(2); // Â∞èÊï∞‰øùÁïô‰∏§‰Ωç
                  },
                },
              },
              tooltip: {
                y: {
                  formatter: (value) => {
                    const formatResult = this.formatFromMB(value);
                    return formatResult.value + formatResult.unit;
                  },
                },
              },
            };
            if (this.chart) {
              this.chart.updateOptions(options);
            } else {
              this.chart = new ApexCharts(
                document.querySelector("#trafficChart"),
                options
              );
              this.chart.render();
            }
          },
          formatFromMB(mb) {
            const units = ["MB", "GB", "TB"];
            let value = Number(mb);
            let i = 0;
            while (value >= 1024 && i < units.length - 1) {
              value /= 1024;
              i++;
            }
            return {
              value: value.toFixed(2),
              unit: units[i],
            };
          },
          getformatTableTime(date, time) {
            const dataType = {
              hour: "fiveminute",
              day: "hour",
              month: "day",
              year: "month",
            }[this.timeRangeType];
            return this.getXValue(date, time, dataType);
          },
          getXAxisTitle() {
            return {
              day: "Â∞èÊó∂",
              month: "Êó•Êúü",
              year: "Êúà‰ªΩ",
            }[this.timeRangeType];
          },
          formatTime(timeObj) {
            if (!timeObj?.timestamp) return "N/A";
            const date = this.getBeijingTime(timeObj.timestamp);
            return `${date.getUTCFullYear()}-${this.pad(
              date.getUTCMonth() + 1
            )}-${this.pad(date.getUTCDate())}
                ${this.pad(date.getUTCHours())}:${this.pad(
              date.getUTCMinutes()
            )}`;
          },
          // Ë°•Èõ∂ÂáΩÊï∞
          pad(num) {
            return num.toString().padStart(2, "0");
          },
          getBeijingTime(timestamp) {
            const date = new Date(timestamp * 1000);
            date.setMinutes(date.getMinutes() + date.getTimezoneOffset() + 480); // UTC+8
            return date;
          },
        },
        async mounted() {
          // ÂàùÂßãÂåñÊó∂Ê£ÄÊü•Êú¨Âú∞Token
          const storedToken = localStorage.getItem('jwt_token');
          // ÂàùÂßãÂåñÊ£ÄÊü•ÁºìÂ≠òapiÈÄâÈ°π
          const assistApi = localStorage.getItem('assist_api');
          if(assistApi){
            this.assistApi = assistApi
          }
          if (storedToken) {
              // È™åËØÅTokenÊúâÊïàÊÄß
              this.authToken = storedToken
              const response = await this.fetchWithAuth(`${this.assistApi}/auth/verify`)
              if (response.ok) {
                this.handleAuthSuccess(storedToken);
              }
          }else{
            this.handleLogout();
          }
        },
      });
    </script>
  </body>
</html>
